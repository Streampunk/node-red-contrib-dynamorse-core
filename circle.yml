machine:
  node:
    version: 4.7.2

dependencies:
  override:
    - npm install
  post:
    - npm install -g tape
    - npm install -g node-red
    - npm install -g pm2
    - pm2 start /opt/circleci/nodejs/v4.2.6/bin/node-red
    - |
      curl -d adminInstall.json -H 'Content-Type: application/json' 127.0.0.1:1880/nodes

test:
  override:
    - npm install -g tap-xunit
    - mkdir $CIRCLE_TEST_REPORTS/xunit
    - npm test | tap-xunit > $CIRCLE_TEST_REPORTS/xunit/results.xml
